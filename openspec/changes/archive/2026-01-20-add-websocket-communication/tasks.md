## 1. 项目设置

- [x] 1.1 添加 gorilla/websocket 依赖
- [x] 1.2 创建 `pkg/server/` 包目录
- [x] 1.3 创建 `pkg/protocol/` 包目录

## 2. 消息协议定义

- [x] 2.1 定义消息类型枚举
- [x] 2.2 定义控制消息结构（Client → Server）
- [x] 2.3 定义状态消息结构（Server → Client）
- [x] 2.4 定义错误消息结构
- [x] 2.5 定义心跳消息结构
- [x] 2.6 实现 JSON 序列化/反序列化
- [x] 2.7 编写协议定义的单元测试

## 3. WebSocket 服务器核心

- [x] 3.1 定义 Server 结构体
- [x] 3.2 定义 Client 结构体（会话管理）
- [x] 3.3 实现 WebSocket 升级处理器
- [x] 3.4 实现客户端连接处理
- [x] 3.5 实现消息读取循环
- [x] 3.6 实现消息写入队列
- [x] 3.7 实现连接清理

## 4. 消息处理

- [x] 4.1 实现消息路由器
- [x] 4.2 实现控制命令处理器
- [x] 4.3 实现 move_left 命令
- [x] 4.4 实现 move_right 命令
- [x] 4.5 实现 move_down 命令
- [x] 4.6 实现 rotate 命令
- [x] 4.7 实现 hard_drop 命令
- [x] 4.8 实现 pause 命令
- [x] 4.9 实现 resume 命令
- [x] 4.10 编写消息处理的单元测试

## 5. 游戏状态同步

- [x] 5.1 实现状态序列化函数
- [x] 5.2 实现状态变化检测
- [x] 5.3 实现状态更新广播
- [x] 5.4 集成游戏引擎的 Update 方法
- [x] 5.5 实现自动状态推送（每帧）
- [x] 5.6 编写状态同步的单元测试

## 6. 心跳机制

- [x] 6.1 实现 ping 消息发送
- [x] 6.2 实现 pong 消息接收
- [x] 6.3 实现心跳计时器（30秒间隔）
- [x] 6.4 实现超时检测（60秒）
- [x] 6.5 实现超时后断开连接
- [x] 6.6 编写心跳机制的单元测试

## 7. 连接管理

- [x] 7.1 实现会话注册
- [x] 7.2 实现会话注销
- [x] 7.3 实现并发安全的会话映射
- [x] 7.4 实现连接状态跟踪
- [x] 7.5 实现优雅关闭
- [x] 7.6 编写连接管理的单元测试

## 8. 错误处理

- [x] 8.1 实现错误消息生成
- [x] 8.2 实现错误日志记录
- [x] 8.3 处理无效消息格式
- [x] 8.4 处理游戏状态错误
- [x] 8.5 处理服务器内部错误
- [x] 8.6 编写错误处理的单元测试

## 9. 并发安全

- [x] 9.1 使用互斥锁保护共享状态
- [x] 9.2 实现线程安全的消息队列
- [x] 9.3 使用 WaitGroup 管理并发
- [x] 9.4 实现优雅关闭机制
- [x] 9.5 编写并发测试

## 10. HTTP 端点

- [x] 10.1 实现 HTTP 路由（使用标准库或 gorilla/mux）
- [x] 10.2 实现 WebSocket 升级端点 `/ws`
- [x] 10.3 实现健康检查端点 `/health`
- [x] 10.4 实现根端点 `/`（欢迎消息）
- [x] 10.5 编写 HTTP 端点的集成测试

## 11. 测试覆盖

- [x] 11.1 编写所有单元测试（目标覆盖率 > 80%）
- [x] 11.2 编写集成测试（完整通信流程）
- [x] 11.3 编写端到端测试（客户端模拟）
- [x] 11.4 测试并发场景
- [x] 11.5 测试错误场景

## 12. 代码质量

- [x] 12.1 运行 `go vet` 检查代码
- [x] 12.2 运行 `gofmt -s -w` 格式化代码
- [x] 12.3 添加代码文档注释
- [x] 12.4 确保所有导出函数有文档

## 13. 示例和文档

- [x] 13.1 创建简单的 HTML 测试客户端
- [x] 13.2 编写 WebSocket 协议文档
- [x] 13.3 编写服务器启动说明
- [x] 13.4 提供示例消息格式

## 14. 主程序集成

- [x] 14.1 创建 `cmd/server/` 目录
- [x] 14.2 实现 main.go 服务器入口
- [x] 14.3 实现命令行参数解析（端口、日志级别）
- [x] 14.4 实现优雅关闭信号处理
- [x] 14.5 验证服务器可以独立运行
